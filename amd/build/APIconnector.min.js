define(["jquery","local_eexcess/eexcesspeas"],function(a,b){var c={base_url:"https://eexcess.joanneum.at/eexcess-privacy-proxy-issuer-1.0-SNAPSHOT/issuer/",timeout:1e4,logTimeout:5e3,logggingLevel:0,cacheSize:10,suffix_recommend:"recommend",suffix_details:"getDetails",suffix_favicon:"getPartnerFavIcon?partnerId=",suffix_log:"log/",suffix_getRegisteredPartners:"getRegisteredPartners",numResults:30};b.init(c.base_url);var d,e=[],f=function(a){e.length===c.cacheSize&&e.shift(),e.push(a)},g=function(a){this.toString=function(){return a}},h=function(a){if("undefined"==typeof a)throw new g("origin undefined");if("undefined"==typeof a.module)throw new g("origin.module undfined");if("undefined"==typeof c.origin)throw new g('origin undefined (need to initialize via APIconnector.init({origin:{clientType:"<name of client>", clientVersion:"version nr",userID:"<UUID>"}})');if("undefined"==typeof c.origin.clientType)throw new g('origin.clientType undefined (need to initialize via APIconnector.init({origin:{clientType:"<name of client>"}})');if("undefined"==typeof c.origin.clientVersion)throw new g('origin.clientVersion undefined (need to initialize via APIconnector.init({origin:{clientVersion:"<version nr>"}})');if("undefined"==typeof c.origin.userID)throw new g('origin.userID undefined (need to initialize via APIconnector.init({origin:{userID:"<UUID>"}})');return a.clientType=c.origin.clientType,a.clientVersion=c.origin.clientVersion,a.userID=c.origin.userID,a};return{init:function(b){c=a.extend(c,b)},setNumResults:function(a){c.numResults=a},query:function(b,e){b.loggingLevel=c.logggingLevel,b.origin=h(b.origin),b.numResults||(b.numResults=c.numResults),d&&4!==d.readyState&&d.abort(),d=a.ajax({url:c.base_url+c.suffix_recommend,data:JSON.stringify(b),type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",timeout:c.timeout}),d.done(function(a){a.profile=b,a.faviconURL=c.base_url+c.suffix_favicon,f(a),"undefined"!=typeof e&&e({status:"success",data:a})}),d.fail(function(a,b,c){"abort"!==b&&(console.log(a),console.log(b),console.log(c),"undefined"!=typeof e&&e({status:"error",data:b}))})},queryPeas:function(a,c,d){var e=b.obfuscateQuery(a,c);this.query(e,function(c){if("success"===c.status){var e=b.filterResults(c.data,a);e.profile=a,d({status:c.status,data:e})}else d({status:c.status,data:c.data})})},getDetails:function(b,d){b.loggingLevel=c.logggingLevel,b.origin=h(b.origin);var e=a.ajax({url:c.base_url+c.suffix_details,data:JSON.stringify(b),type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",timeout:c.timeout});e.done(function(a){d({status:"success",data:a})}),e.fail(function(a,b,c){"abort"!==b&&(console.log(a),console.log(b),console.log(c),"undefined"!=typeof d&&d({status:"error",data:b}))})},getCache:function(){return e},getCurrent:function(){return e.length>0?e[e.length-1]:null},logInteractionType:{moduleOpened:"moduleOpened",moduleClosed:"moduleClosed",moduleStatisticsCollected:"moduleStatisticsCollected",itemOpened:"itemOpened",itemClosed:"itemClosed",itemCitedAsImage:"itemCitedAsImage",itemCitedAsText:"itemCitedAsText",itemCitedAsHyperlink:"itemCitedAsHyperlink",itemRated:"itemRated"},sendLog:function(b,d){d.origin=h(d.origin);var e;e=a.ajax({url:c.base_url+c.suffix_log+b,data:JSON.stringify(d),type:"POST",contentType:"application/json; charset=UTF-8",timeout:c.logTimeout})},getRegisteredPartners:function(b){d=a.ajax({url:c.base_url+c.suffix_getRegisteredPartners,type:"GET",timeout:5e3}),d.done(function(a){"undefined"!=typeof b&&b({status:"success",data:a})}),d.fail(function(a,c,d){"abort"!==c&&(console.log(a),console.log(c),console.log(d),"undefined"!=typeof b&&b({status:"error",data:c}))})}}});